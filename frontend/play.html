<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <title>パズルプレイ</title>
    <link rel="stylesheet" href="/static/css/play.css">
    <!-- Ionicons for clean UI icons -->
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
</head>

<body>

    <!-- Top Center Toolbar -->
    <div class="header-controls">
        <button class="toolbar-btn" onclick="backToGallery()" title="ギャラリーに戻る">
            <ion-icon name="arrow-back"></ion-icon>
        </button>

        <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.1); margin: 0 5px;"></div>

        <!-- Timer in Header -->
        <div class="timer-box"
            style="margin: 0 10px; font-weight: bold; font-size: 1.2rem; min-width: 80px; text-align: center;">
            <span id="time">0</span><span style="font-size: 0.8rem; margin-left: 2px;">秒</span>
        </div>

        <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.1); margin: 0 5px;"></div>

        <div style="margin: 0 10px; font-weight: bold; font-size: 1.2rem; color: #60a5fa; min-width: 60px; text-align: center;"
            title="残りピース数">
            <ion-icon name="extension-puzzle-outline" style="vertical-align: -2px; margin-right:4px;"></ion-icon>
            <span id="piece-remaining">--</span>
        </div>

        <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.1); margin: 0 5px;"></div>

        <button class="toolbar-btn" onclick="zoomOut()" title="ズームアウト">
            <ion-icon name="remove-circle-outline"></ion-icon>
        </button>
        <button class="toolbar-btn" onclick="zoomIn()" title="ズームイン">
            <ion-icon name="add-circle-outline"></ion-icon>
        </button>

        <div style="width: 1px; height: 24px; background: rgba(255,255,255,0.1); margin: 0 5px;"></div>

        <button class="toolbar-btn" id="hintBtn" title="ヒント (1ピース埋める)">
            <ion-icon name="bulb-outline"></ion-icon>
        </button>
        <button class="toolbar-btn" id="toggleCompletedBtn" title="完成図の表示/非表示">
            <ion-icon name="image-outline"></ion-icon>
        </button>
        <button class="toolbar-btn" onclick="saveGame()" title="保存">
            <ion-icon name="save-outline"></ion-icon>
        </button>
        <button class="toolbar-btn" id="resetBtn" title="リセット">
            <ion-icon name="refresh-outline"></ion-icon>
        </button>
    </div>

    <!-- Top Right Info Panel -->
    <div class="info-panel">
        <div id="status-msg" class="status-msg"></div>
    </div>

    <div id="canvas-container">
        <canvas id="can"></canvas>
    </div>

    <!-- Clear Modal -->
    <div id="completionModal"
        style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:9999; text-align:center; color:white; flex-direction: column; justify-content: center; align-items: center;">

        <h1 style="font-size:4rem; color:#fbbf24; text-shadow: 0 0 20px rgba(251, 191, 36, 0.5); margin: 0;">CLEAR!!
        </h1>

        <div style="font-size:1.5rem; margin: 30px 0;">
            <p>Time: <span id="modalTime" style="font-weight:bold; font-size:2.5rem; color: white;"></span></p>
            <p style="font-size:1rem; color:#94a3b8; margin-top: 10px;">Best: <span id="modalBest">--</span></p>
            <p id="newRecordMsg"
                style="display:none; color:#f87171; font-weight:bold; font-size:1.5rem; margin-top: 15px;">★ New
                Record!!</p>
        </div>

        <div style="display: flex; gap: 20px;">
            <button onclick="backToGallery()"
                style="padding:15px 40px; font-size:1.1rem; background:transparent; border: 2px solid #22c55e; color:#22c55e; border-radius:30px; cursor:pointer; font-weight: bold; transition: all 0.2s;">
                ギャラリーへ
            </button>
            <button onclick="location.reload()"
                style="padding:15px 40px; font-size:1.1rem; background:#22c55e; color:#0f172a; border:none; border-radius:30px; cursor:pointer; font-weight: bold; box-shadow: 0 0 15px rgba(34, 197, 94, 0.4);">
                もう一度
            </button>
        </div>
    </div>

    <img id="completedImagePreview" style="display:none;">

    <!-- Effects -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="/static/js/puzzle_logic.js"></script>
    <script src="/static/js/single_play.js"></script>

</body>

</html>
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ルーム作成</title>
  <link rel="stylesheet" href="/static/css/room_create.css">
</head>

<body>
  <div class="container">
    <h1>ルーム作成</h1>

    <!-- ✅ id付与 & action削除 -->
    <form id="roomCreateForm">

      <label>ルーム名</label>
      <input type="text" name="name" required>

      <label>最大参加人数</label>
      <input type="number" name="max_players" min="2" max="8" required>

      <label>パスワード（任意）</label>
      <input type="password" name="password">

      <button type="submit">作成する</button>
    </form>

    <button onclick="location.href='/mode'">戻る</button>

    <div id="result"></div>
  </div>

<script>
document.getElementById("roomCreateForm").addEventListener("submit", async (e) => {
  e.preventDefault();

  const formData = new FormData(e.target);
  const userId = localStorage.getItem("user_id");

  if (!userId) {
    alert("ログインしてください");
    location.href = "/user/login";
    return;
  }

  try {
    const res = await fetch("/room/create", {
      method: "POST",
      headers: {
        "Authorization": userId   // ✅ 超重要
      },
      body: formData
    });

    const data = await res.json();

    if (res.ok) {
      alert("ルーム作成成功！");
      location.href = `/room/wait?room_id=${data.room_id}`;
    } else {
      document.getElementById("result").innerText = data.detail || "作成失敗";
    }
  } catch (err) {
    document.getElementById("result").innerText = "通信エラー: " + err;
  }
});
</script>

</body>
</html>
